<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>~</title>
		<script type="text/javascript" src="d3-book-2.0.3/d3.js"></script>
		<style type="text/css">
			.line {
				fill: none;
				stroke: black;
				stroke-width: 1;
			}
		</style>
	</head>
	<body>
		<script type="text/javascript">

      var dataset;
			var w = 1210;
			var h = 695;

      // Creates svg
      var svg = d3.select("body").append("svg").attr("width", w).attr("height", h);
			svg.append("rect").attr("x",0).attr("y",0).attr("width", w).attr("height", h).attr("fill", "none");

      //Converts data from csv, making Date object for each year and month
      var rowConverter = function(d) {
				return {
          id: d.id,
          x: parseFloat(d.x),
					y: parseFloat(d.y)
				};
			}


      d3.csv("mcoords.csv", rowConverter, function(data) {

        dataset = data;

				function next(f,l) {
					var wave = dataset.slice(f,l+1);
					for (i = f; i < l; i++) {
						dataset[i].y = wave[(i - f)+1].y;
					}
					dataset[l].y = wave[0].y;
				}

				xSc = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) {return d.x;}), d3.max(dataset, function(d) {return d.x;})])
								.range([1,w]);

				ySc = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) {return d.y;}), d3.max(dataset, function(d) {return d.y;})])
								.range([h,1]);

				var point = [1,1];

        // Line generator
        l1 = d3.line()
                 .defined(function(d) {return d.id == 1;})
                 .x(function(d) {return xSc(d.x);})
                 .y(function(d) {return ySc(d.y);})
								 .curve(d3.curveCardinal);
			  l2 = d3.line()
                 .defined(function(d) {return d.id == 2;})
                 .x(function(d) {return xSc(d.x);})
                 .y(function(d) {return ySc(d.y);})
								 .curve(d3.curveCardinal);
				l3 = d3.line()
                 .defined(function(d) {return d.id == 3;})
                 .x(function(d) {return xSc(d.x);})
                 .y(function(d) {return ySc(d.y);})
								 .curve(d3.curveCardinal);
				l4 = d3.line()
                 .defined(function(d) {return d.id == 4;})
                 .x(function(d) {return xSc(d.x);})
                 .y(function(d) {return ySc(d.y);})
								 .curve(d3.curveCardinal);
				l5 = d3.line()
                 .defined(function(d) {return d.id == 5;})
                 .x(function(d) {return xSc(d.x);})
                 .y(function(d) {return ySc(d.y);})
								 .curve(d3.curveCardinal);

        // Creates line
        svg.append("path").datum(dataset).attr("class", "line").attr("d", l1);
				svg.append("path").datum(dataset).attr("class", "line").attr("d", l2);
				svg.append("path").datum(dataset).attr("class", "line").attr("d", l3);
				svg.append("path").datum(dataset).attr("class", "line").attr("d", l4);
				svg.append("path").datum(dataset).attr("class", "line").attr("d", l5);

				svg.selectAll(".dots").data(dataset).enter().append("circle").attr("class","dots")
					 .attr("cx",function(d) {return xSc(d.x);})
					 .attr("cy",function(d) {return ySc(d.y);})
					 .attr("r",2)
					 .attr("fill","black");

				var frame = 0;

				d3.select("body").select("svg")
				                 .on("mousemove", function() {

													 var pt = d3.mouse(this);
													 point = pt;
													 xhalf = point[0]/1.2;
													 yhalf = point[1]/1.2;
													 xmarg = (w - xhalf) / 4;
													 ymarg = (h - yhalf) / 2;

													 if (frame == 0) {
														 next(0,36);
														 next(37,73);
														 next(74,110);
														 next(111,147);
														 next(148,184);
														 frame = 1;
													 }
													 else if (frame < 6) {frame++;}
													 else frame = 0;

													 xSc = d3.scaleLinear()
									 								.domain([d3.min(dataset, function(d) {return d.x;}), d3.max(dataset, function(d) {return d.x;})])
									 								.range([xmarg,w - xmarg]);
													 ySc = d3.scaleLinear()
			 									 					 .domain([d3.min(dataset, function(d) {return d.y;}), d3.max(dataset, function(d) {return d.y;})])
			 									 					 .range([h - ymarg,ymarg]);

													 l1 = d3.line()
									                  .defined(function(d) {return d.id == 1;})
									                  .x(function(d) {return xSc(d.x);})
									                  .y(function(d) {return ySc(d.y);})
									 								 .curve(d3.curveCardinal);
													 l2 = d3.line()
									                  .defined(function(d) {return d.id == 2;})
									                  .x(function(d) {return xSc(d.x);})
									                  .y(function(d) {return ySc(d.y);})
									 								 .curve(d3.curveCardinal);
									 				l3 = d3.line()
									                  .defined(function(d) {return d.id == 3;})
									                  .x(function(d) {return xSc(d.x);})
									                  .y(function(d) {return ySc(d.y);})
									 								 .curve(d3.curveCardinal);
									 				l4 = d3.line()
									                  .defined(function(d) {return d.id == 4;})
									                  .x(function(d) {return xSc(d.x);})
									                  .y(function(d) {return ySc(d.y);})
									 								 .curve(d3.curveCardinal);
									 				l5 = d3.line()
									                  .defined(function(d) {return d.id == 5;})
									                  .x(function(d) {return xSc(d.x);})
									                  .y(function(d) {return ySc(d.y);})
									 								 .curve(d3.curveCardinal);

													 svg.selectAll(".line").remove();
													 svg.append("path").datum(dataset).attr("class", "line").attr("d", l1);
													 svg.append("path").datum(dataset).attr("class", "line").attr("d", l2);
													 svg.append("path").datum(dataset).attr("class", "line").attr("d", l3);
													 svg.append("path").datum(dataset).attr("class", "line").attr("d", l4);
													 svg.append("path").datum(dataset).attr("class", "line").attr("d", l5);

													 svg.selectAll(".dots").remove();
													 svg.selectAll(".dots").data(dataset).enter().append("circle").attr("class","dots")
													 		.attr("cx",function(d) {return xSc(d.x);})
															.attr("cy",function(d) {return ySc(d.y);})
															.attr("r",2)
															.attr("fill","black");

												 });

				svg.append("text").text("Equipment").attr("x",9).attr("y",35).attr("font-family","sans-serif").attr("font-size",30)
					 .on("mouseover", function() {
						 d3.select(this).attr("fill","blue");
					 })
					 .on("mouseout", function() {
						 d3.select(this).attr("fill","black");
					 });
				svg.append("text").text("Solutions").attr("x",9).attr("y",h-13).attr("font-family","sans-serif").attr("font-size",30)
					 .on("mouseover", function() {
						 d3.select(this).attr("fill","blue");
					 })
					 .on("mouseout", function() {
						 d3.select(this).attr("fill","black");
					 });;
				svg.append("text").text("Vessels").attr("x",w-113).attr("y",h-13).attr("font-family","sans-serif").attr("font-size",30)
					.on("mouseover", function() {
						d3.select(this).attr("fill","blue");
					})
					.on("mouseout", function() {
						d3.select(this).attr("fill","black");
					});;
				svg.append("text").text("OM").attr("x",w-55).attr("y",35).attr("font-family","sans-serif").attr("font-size",30)
					.on("mouseover", function() {
						d3.select(this).text("Optic Marine").attr("x",w-178);
					})
					.on("mouseout", function() {
						d3.select(this).text("OM").attr("x",w-55);
					});

      });

		</script>
	</body>
</html>
